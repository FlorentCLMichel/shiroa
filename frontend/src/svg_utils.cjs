const ignoredEvent=function(){const t={};let e,n;return function(i,m,h){n=new Date().getTime(),h=h||"ignored event",e=t[h]?n-t[h]:n,e>m&&(t[h]=n,i())}}(),fc=(t,e)=>{const n=[];for(let i=0;i<t.length;i++){const m=t[i];e(m)&&n.push(m)}return n},overLappingBox=(t,e)=>!(t.right<e.left||t.left>e.right||t.bottom<e.top||t.top>e.bottom),almostOverLapping=(t,e)=>{const n=t.getBoundingClientRect(),i=e.getBoundingClientRect();return overLappingBox(n,i)&&Math.abs(n.left-i.left)+Math.abs(n.right-i.right)<.5*Math.max(n.width,i.width)&&Math.abs(n.bottom-i.bottom)+Math.abs(n.top-i.top)<.5*Math.max(n.height,i.height)},gr=window.typstGetRelatedElements=t=>{let e=t.relatedElements;return e==null&&(e=t.relatedElements=searchIntersections(t)),e},getRelatedElements=t=>gr(t.target),findAncestor=(t,e)=>{for(;t&&!t.classList.contains(e);)t=t.parentElement;return t};function findGlyphListForText(t){const e=findAncestor(t,"typst-text");return e&&fc(e.children,n=>n.tagName==="use")}const searchIntersections=function(t){const e=findAncestor(t,"typst-group");return e&&fc(e.children,n=>almostOverLapping(n,t))};function nextNode(t){if(t.hasChildNodes())return t.firstChild;for(;t&&!t.nextSibling;)t=t.parentNode;return t?t.nextSibling:null}function getRangeSelectedNodes(t,e){var n=t.startContainer,i=t.endContainer;if(n==i){if(e(n))return[n];if(e(n.parentElement))return[n.parentElement]}for(var m=[];n&&n!=i;)n=nextNode(n),e(n)&&m.push(n);for(n=t.startContainer;n&&n!=t.commonAncestorContainer;)e(n)&&m.unshift(n),n=n.parentNode;return m}function getSelectedNodes(t){if(window.getSelection){var e=window.getSelection();if(!e.isCollapsed){if(e.rangeCount===1)return getRangeSelectedNodes(e.getRangeAt(0),t);let n=[];for(let i=0,m=e.rangeCount;i<m;i++)n.push(...getRangeSelectedNodes(e.getRangeAt(i),t));return n}}return[]}function getGlyphLenShape(t){return t.map(e=>{const n=e.getAttribute("href"),i=document.getElementById(n.slice(1));return 1+Number.parseInt(i?.getAttribute("data-liga-len")||"0")})}function getGlyphAdvanceShape(t){return t.map(e=>Number.parseInt(e.getAttribute("x")||"0"))}const linkmove=t=>ignoredEvent(()=>gr(t)?.forEach(e=>e.classList.add("hover")),200,"mouse-move"),linkleave=t=>gr(t)?.forEach(e=>e.classList.remove("hover"));window.typstProcessSvg=function(t,e){for(var n=t.getElementsByClassName("pseudo-link"),i=0;i<n.length;i++){var m=n[i];m.addEventListener("mousemove",y=>linkmove(y.target)),m.addEventListener("mouseleave",y=>linkleave(y.target))}if((e?.layoutText??!0)&&setTimeout(()=>{const y=document.createElement("style");y.innerHTML=`.tsel { font-family: monospace; text-align-last: left !important; -moz-text-size-adjust: none; -webkit-text-size-adjust: none; text-size-adjust: none; overflow: hidden; }
.tsel span { position: relative !important; width: fit-content !important;  }`,document.getElementsByTagName("head")[0].appendChild(y),window.layoutText(t)},0),t.addEventListener("click",y=>{let u=y.target;for(;u;){const g=u.getAttribute("data-span");if(g){console.log("source-span of this svg element",g);const l=document.body||document.firstElementChild,E=l.getBoundingClientRect(),p=window.innerWidth||0,L=y.clientX-E.left+.015*p,C=y.clientY-E.top+.015*p;triggerRipple(l,L,C,"typst-debug-react-ripple","typst-debug-react-ripple-effect .4s linear");return}u=u.parentElement}}),window.location.hash){const u=window.location.hash.split("-");if(u.length===2&&u[0]==="#loc"){const g=u[1].split("x");if(g.length===3){const l=Number.parseInt(g[0]),E=Number.parseFloat(g[1]),p=Number.parseFloat(g[2]);window.handleTypstLocation(t,l,E,p)}}}};const LB=`
`.codePointAt(0);window.layoutText=async function(t){const e=Array.from(t.querySelectorAll(".tsel, .typst-content-hint, .pseudo-link")),n=performance.now(),i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas").getContext("2d");i.font="128px monospace";const m=i.measureText("A").width,h=t.getBoundingClientRect(),y=h.left+window.scrollX,u=h.top+window.scrollY,g=(r,x,c)=>{var o=r.getScreenCTM();return o?{x:o.a*x+o.c*c+o.e-y,y:o.b*x+o.d*c+o.f-u}:{x:0,y:0}};let l;const E=t.parentElement;if(!E)l=void 0;else if(t.nextElementSibling?.classList.contains("typst-semantic-layer"))l=t.nextElementSibling;else{l=document.createElement("div");const r=document.createElement("div");r.style.position="relative",E.replaceChild(r,t),r.appendChild(t),r.appendChild(l),l.classList.add("typst-semantic-layer"),l.style.position="absolute",l.style.left="0",l.style.top="0",l.style.zIndex="1",l.style.float="left";const x=t.getAttribute("width");l.style.width=`${x}px`;const c=t.getAttribute("height");l.style.height=`${c}px`}let p={left:0,right:0,bottom:0,top:0},L=[];const C=(r,x="span")=>{const c=document.createElement(x),o=r.getBBox(),a=g(r,o.x,o.y),s=g(r,o.x+o.width,o.y+o.height),S=Math.min(a.x,s.x)+window.scrollX,b=Math.min(a.y,s.y)+window.scrollY,w=Math.abs(a.x-s.x),M=Math.abs(a.y-s.y),v=M/2,T={left:S-v,top:b-v,right:S+w+v,bottom:b+M+v};return overLappingBox(p,T)?(p.left=Math.min(p.left,T.left),p.top=Math.min(p.top,T.top),p.right=Math.max(p.right,T.right),p.bottom=Math.max(p.bottom,T.bottom)):(L.push([c,p]),p=T),c.classList.add("tsel"),c.style.position="absolute",c.style.left=`${S}px`,c.style.top=`${b}px`,c.style.width=`${w}px`,c.style.height=`${M}px`,c},N=!1,A=(r,x)=>{const c=e.slice(r,x);for(let o of c){const a=o.parentElement;if(l){if(o.classList.contains("typst-content-hint")){const s=C(o);s.style.fontSize="0.1px",s.style.width="0.1px",s.style.height="0.1px";const d=Number.parseInt(o.getAttribute("data-hint")||"0",16)||LB;s.innerHTML=d===LB?"<br/>":`&#x${d.toString(16)};`,l.append(s);continue}else if(o.classList.contains("pseudo-link")){const s=C(o,"a");s.style.cursor="pointer",s.addEventListener("mousemove",()=>linkmove(o)),s.addEventListener("mouseleave",()=>linkleave(o)),s.onclick=()=>{o.dispatchEvent(new MouseEvent("click",{bubbles:!0}))},s.addEventListener("mouseenter",()=>{const d=o.parentElement?.getAttribute("href")||o.parentElement?.getAttribute("xlink:href");s.getAttribute("href")!==d&&s.setAttribute("href",d||"")}),l.append(s);continue}}if(o.style.fontSize){const s=[],d=o.innerText,S=m*Number.parseFloat(o.style.fontSize)/128;if(N){const f=document.createElement("span");f.textContent=d;const b=a.getBBox(),w=S*d.length;if(a){const M=b.width/w;f.style.display="inline-block",f.style.transform=`scaleX(${M})`,f.style.transformOrigin="left"}s.push(f)}else{const f=findGlyphListForText(o);if(!f)continue;const b=getGlyphLenShape(f),w=getGlyphAdvanceShape(f).map(R=>R/16);let M=!1,v=0,T=0,F=0,H,G=0;for(let R of d){if(v>=w.length){M=!0;break}let k=w[v];b[v]>1&&(k+=T*S),T++,T>=b[v]&&(v++,T=0);const $=document.createElement("span");$.textContent=R,$.classList.add("tsel-tok"),H&&(H.style.letterSpacing=`${k-G-S}px`),H=$,G=k,s.push($),F+=1}if(M)continue}if(o.innerHTML="",l){const f=Number.parseFloat(o.style.fontSize||"0"),b=Math.abs(g(a,0,f).y-g(a,0,0).y);if(!N){const M=b/f;for(let v of s)v.style.letterSpacing=`${Number.parseFloat(v.style.letterSpacing||"0")*M}px`}const w=C(a);w.style.fontSize=`${b}px`,w.append(...s),l.append(w)}else o.append(...s)}}console.log(`layoutText ${e.length} elements used since ${performance.now()-n} ms`)},B=100;for(let r=0;r<e.length;r+=B){const x=r;await new Promise(c=>{setTimeout(()=>{A(x,x+B),c(void 0)})})}if(l&&p.right!=0&&L.push([null,p]),l){const r=performance.now(),x=["red","green","blue","purple","orange"];let c=0;for(let[o,a]of L){if(c<L.length-1){let d=L[c+1][1],S=a.left<d.left,f=a.top<d.top,b=a.right<d.right,w=a.bottom<d.bottom;S!=b&&(a.left=Math.min(a.left,d.left),a.right=Math.max(a.right,d.right)),f!=w&&(a.top=Math.min(a.top,d.top),a.bottom=Math.max(a.bottom,d.bottom))}const s=document.createElement("span");s.style.zIndex="-1",s.style.position="absolute",s.style.left=`${a.left}px`,s.style.top=`${a.top}px`,s.style.width=`${a.right-a.left}px`,s.style.height=`${a.bottom-a.top}px`,s.dir="ltr",s.style.unicodeBidi="isolated",l.insertBefore(s,o),c++}console.log(`layout paragraph used since ${performance.now()-r} ms`)}},window.handleTypstLocation=function(t,e,n,i,m){if(t.classList.contains("typst-semantic-layer"))return t=t.firstElementChild,t&&window.handleTypstLocation(t,e,n,i,m);const h=m?.behavior||"smooth",y=window.assignSemaHash||((E,p,L)=>{location.hash=`loc-${E}x${p.toFixed(2)}x${L.toFixed(2)}`}),u=findAncestor(t,"typst-doc");if(!u){console.warn("no typst-doc found",t);return}const g=u.children;let l=0;for(let E=0;E<g.length;E++)if(g[E].tagName==="g"&&l++,l==e){const p=window.innerWidth*.01,L=window.innerHeight*.01,C=g[E],N=Number.parseFloat(u.getAttribute("data-width")||u.getAttribute("width")||"0")||0,A=Number.parseFloat(u.getAttribute("data-height")||u.getAttribute("height")||"0")||0,B=u.getBoundingClientRect(),r={left:B.left,top:B.top,width:B.width,height:B.height},x=7*p,c=38.2*L,o=C.transform.baseVal.consolidate()?.matrix;o&&(r.left+=o.e/N*r.width,r.top+=o.f/A*r.height);const a=document.body||document.firstElementChild,s=a.getBoundingClientRect(),d=r.left-s.left+n/N*r.width-x,S=r.top-s.top+i/A*r.height-c,f=d+x,b=S+c;window.scrollTo({behavior:h,left:d,top:S}),h!=="instant"&&triggerRipple(a,f,b,"typst-jump-ripple","typst-jump-ripple-effect .4s linear"),y(l,n,i);return}};function triggerRipple(t,e,n,i,m){const h=document.createElement("div");h.className=i,h.style.left=`${e}px`,h.style.top=`${n}px`,t.appendChild(h),h.style.animation=m,h.onanimationend=()=>{t.removeChild(h)}}var scriptTag=document.currentScript;if(scriptTag){console.log("new svg util updated 37  ",performance.now());const t=findAncestor(scriptTag,"typst-doc");t&&window.typstProcessSvg(t)}
