const ignoredEvent=function(){const t={};let e,n;return function(o,r,a){n=new Date().getTime(),a=a||"ignored event",e=t[a]?n-t[a]:n,e>r&&(t[a]=n,o())}}(),fc=(t,e)=>{const n=[];for(let o=0;o<t.length;o++){const r=t[o];e(r)&&n.push(r)}return n},overLappingBox=(t,e)=>!(t.right<e.left||t.left>e.right||t.bottom<e.top||t.top>e.bottom),almostOverLapping=(t,e)=>{const n=t.getBoundingClientRect(),o=e.getBoundingClientRect();return overLappingBox(n,o)&&Math.abs(n.left-o.left)+Math.abs(n.right-o.right)<.5*Math.max(n.width,o.width)&&Math.abs(n.bottom-o.bottom)+Math.abs(n.top-o.top)<.5*Math.max(n.height,o.height)},gr=window.typstGetRelatedElements=t=>{let e=t.relatedElements;return e==null&&(e=t.relatedElements=searchIntersections(t)),e},getRelatedElements=t=>gr(t.target),findAncestor=(t,e)=>{for(;t&&!t.classList.contains(e);)t=t.parentElement;return t};function findGlyphListForText(t){const e=findAncestor(t,"typst-text");return e&&fc(e.children,n=>n.tagName==="use")}const searchIntersections=function(t){const e=findAncestor(t,"typst-group");return e&&fc(e.children,n=>almostOverLapping(n,t))};function nextNode(t){if(t.hasChildNodes())return t.firstChild;for(;t&&!t.nextSibling;)t=t.parentNode;return t?t.nextSibling:null}function getRangeSelectedNodes(t,e){var n=t.startContainer,o=t.endContainer;if(n==o){if(e(n))return[n];if(e(n.parentElement))return[n.parentElement]}for(var r=[];n&&n!=o;)n=nextNode(n),e(n)&&r.push(n);for(n=t.startContainer;n&&n!=t.commonAncestorContainer;)e(n)&&r.unshift(n),n=n.parentNode;return r}function getSelectedNodes(t){if(window.getSelection){var e=window.getSelection();if(!e.isCollapsed){if(e.rangeCount===1)return getRangeSelectedNodes(e.getRangeAt(0),t);let n=[];for(let o=0,r=e.rangeCount;o<r;o++)n.push(...getRangeSelectedNodes(e.getRangeAt(o),t));return n}}return[]}function getGlyphLenShape(t){return t.map(e=>{const n=e.getAttribute("href"),o=document.getElementById(n.slice(1));return 1+Number.parseInt(o?.getAttribute("data-liga-len")||"0")})}function getGlyphAdvanceShape(t){return t.map(e=>Number.parseInt(e.getAttribute("x")||"0"))}const linkmove=t=>ignoredEvent(()=>gr(t)?.forEach(e=>e.classList.add("hover")),200,"mouse-move"),linkleave=t=>gr(t)?.forEach(e=>e.classList.remove("hover")),semaLinkEnter=(t,e)=>()=>{const n=e.parentElement?.getAttribute("href")||e.parentElement?.getAttribute("xlink:href");t.getAttribute("href")!==n&&t.setAttribute("href",n||"")};window.typstProcessSvg=function(t,e){for(var n=t.getElementsByClassName("pseudo-link"),o=0;o<n.length;o++){var r=n[o];r.addEventListener("mousemove",f=>linkmove(f.target)),r.addEventListener("mouseleave",f=>linkleave(f.target))}if((e?.layoutText??!0)&&setTimeout(()=>{const f=document.createElement("style");f.innerHTML=`.tsel { font-family: monospace; text-align-last: left !important; -moz-text-size-adjust: none; -webkit-text-size-adjust: none; text-size-adjust: none; overflow: hidden; }
.tsel span { position: relative !important; width: fit-content !important;  }`,document.getElementsByTagName("head")[0].appendChild(f),window.layoutText(t)},0),t.addEventListener("click",f=>{let h=f.target;for(;h;){const b=h.getAttribute("data-span");if(b){console.log("source-span of this svg element",b);const c=document.body||document.firstElementChild,x=c.getBoundingClientRect(),p=window.innerWidth||0,L=f.clientX-x.left+.015*p,C=f.clientY-x.top+.015*p;triggerRipple(c,L,C,"typst-debug-react-ripple","typst-debug-react-ripple-effect .4s linear");return}h=h.parentElement}}),window.location.hash){const h=window.location.hash.split("-");if(h.length===2&&h[0]==="#loc"){const b=h[1].split("x");if(b.length===3){const c=Number.parseInt(b[0]),x=Number.parseFloat(b[1]),p=Number.parseFloat(b[2]);window.handleTypstLocation(t,c,x,p)}}}};const LB=`
`.codePointAt(0);window.layoutText=async function(t){const e=Array.from(t.querySelectorAll(".tsel, .typst-content-hint, .pseudo-link")),n=performance.now(),o=document.createElementNS("http://www.w3.org/1999/xhtml","canvas").getContext("2d");o.font="128px monospace";const r=o.measureText("A").width,a=t.getBoundingClientRect(),f=a.left+window.scrollX,h=a.top+window.scrollY,b=(m,y,d)=>{var s=m.getScreenCTM();return s?{x:s.a*y+s.c*d+s.e-f,y:s.b*y+s.d*d+s.f-h}:{x:0,y:0}};let c;const x=t.parentElement;if(!x)c=void 0;else if(t.nextElementSibling?.classList.contains("typst-semantic-layer"))c=t.nextElementSibling;else{c=document.createElement("div");const m=document.createElement("div");m.style.position="relative",x.replaceChild(m,t),m.appendChild(t),m.appendChild(c),c.classList.add("typst-semantic-layer"),c.style.position="absolute",c.style.left="0",c.style.top="0",c.style.zIndex="1",c.style.float="left";const y=t.getAttribute("width");c.style.width=`${y}px`;const d=t.getAttribute("height");c.style.height=`${d}px`}let p={left:0,right:0,bottom:0,top:0},L=[];const C=(m,y="span")=>{const d=document.createElement(y),s=m.getBBox(),l=b(m,s.x,s.y),i=b(m,s.x+s.width,s.y+s.height),S=Math.min(l.x,i.x)+window.scrollX,E=Math.min(l.y,i.y)+window.scrollY,w=Math.abs(l.x-i.x),T=Math.abs(l.y-i.y),v=T/2,M={left:S-v,top:E-v,right:S+w+v,bottom:E+T+v};return overLappingBox(p,M)?(p.left=Math.min(p.left,M.left),p.top=Math.min(p.top,M.top),p.right=Math.max(p.right,M.right),p.bottom=Math.max(p.bottom,M.bottom)):(L.push([d,p]),p=M),d.classList.add("tsel"),d.style.position="absolute",d.style.left=`${S}px`,d.style.top=`${E}px`,d.style.width=`${w}px`,d.style.height=`${T}px`,d},A=!1,N=(m,y)=>{const d=e.slice(m,y);for(let s of d){const l=s.parentElement;if(c){if(s.classList.contains("typst-content-hint")){const i=C(s);i.style.fontSize="0.1px",i.style.width="0.1px",i.style.height="0.1px";const u=Number.parseInt(s.getAttribute("data-hint")||"0",16)||LB;i.innerHTML=u===LB?"<br/>":`&#x${u.toString(16)};`,c.append(i);continue}else if(s.classList.contains("pseudo-link")){const i=C(s,"a");i.style.cursor="pointer",i.addEventListener("mousemove",()=>linkmove(s)),i.addEventListener("mouseleave",()=>linkleave(s)),i.onclick=()=>{s.dispatchEvent(new MouseEvent("click",{bubbles:!0}))},i.addEventListener("mouseenter",()=>{const u=s.parentElement?.getAttribute("href")||s.parentElement?.getAttribute("xlink:href");i.getAttribute("href")!==u&&i.setAttribute("href",u||"")}),c.append(i);continue}}if(s.style.fontSize){const i=[],u=s.innerText,S=r*Number.parseFloat(s.style.fontSize)/128;if(A){const g=document.createElement("span");g.textContent=u;const E=l.getBBox(),w=S*u.length;if(l){const T=E.width/w;g.style.display="inline-block",g.style.transform=`scaleX(${T})`,g.style.transformOrigin="left"}i.push(g)}else{const g=findGlyphListForText(s);if(!g)continue;const E=getGlyphLenShape(g),w=getGlyphAdvanceShape(g).map($=>$/16);let T=!1,v=0,M=0,F=0,G,k=0;for(let $ of u){if(v>=w.length){T=!0;break}let R=w[v];E[v]>1&&(R+=M*S),M++,M>=E[v]&&(v++,M=0);const H=document.createElement("span");H.textContent=$,H.classList.add("tsel-tok"),G&&(G.style.letterSpacing=`${R-k-S}px`),G=H,k=R,i.push(H),F+=1}if(T)continue}if(s.innerHTML="",c){const g=Number.parseFloat(s.style.fontSize||"0"),E=Math.abs(b(l,0,g).y-b(l,0,0).y);if(!A){const T=E/g;for(let v of i)v.style.letterSpacing=`${Number.parseFloat(v.style.letterSpacing||"0")*T}px`}const w=C(l);w.style.fontSize=`${E}px`,w.append(...i),c.append(w)}else s.append(...i)}}console.log(`layoutText ${e.length} elements used since ${performance.now()-n} ms`)},B=100;for(let m=0;m<e.length;m+=B){const y=m;await new Promise(d=>{setTimeout(()=>{N(y,y+B),d(void 0)})})}if(c&&p.right!=0&&L.push([null,p]),c){const m=performance.now(),y=["red","green","blue","purple","orange"];let d=0;for(let[s,l]of L){if(d<L.length-1){let u=L[d+1][1],S=l.left<u.left,g=l.top<u.top,E=l.right<u.right,w=l.bottom<u.bottom;S!=E&&(l.left=Math.min(l.left,u.left),l.right=Math.max(l.right,u.right)),g!=w&&(l.top=Math.min(l.top,u.top),l.bottom=Math.max(l.bottom,u.bottom))}const i=document.createElement("span");i.style.zIndex="-1",i.style.position="absolute",i.style.left=`${l.left}px`,i.style.top=`${l.top}px`,i.style.width=`${l.right-l.left}px`,i.style.height=`${l.bottom-l.top}px`,i.dir="ltr",i.style.unicodeBidi="isolated",c.insertBefore(i,s),d++}console.log(`layout paragraph used since ${performance.now()-m} ms`)}},window.handleTypstLocation=function(t,e,n,o,r){if(t.classList.contains("typst-semantic-layer"))return t=t.firstElementChild,t&&window.handleTypstLocation(t,e,n,o,r);const a=r?.behavior||"smooth",f=window.assignSemaHash||((x,p,L)=>{location.hash=`loc-${x}x${p.toFixed(2)}x${L.toFixed(2)}`}),h=findAncestor(t,"typst-doc");if(!h){console.warn("no typst-doc found",t);return}const b=h.children;let c=0;for(let x=0;x<b.length;x++)if(b[x].tagName==="g"&&c++,c==e){const p=window.innerWidth*.01,L=window.innerHeight*.01,C=b[x],A=Number.parseFloat(h.getAttribute("data-width")||h.getAttribute("width")||"0")||0,N=Number.parseFloat(h.getAttribute("data-height")||h.getAttribute("height")||"0")||0,B=h.getBoundingClientRect(),m={left:B.left,top:B.top,width:B.width,height:B.height},y=7*p,d=38.2*L,s=C.transform.baseVal.consolidate()?.matrix;s&&(m.left+=s.e/A*m.width,m.top+=s.f/N*m.height);const l=document.body||document.firstElementChild,i=l.getBoundingClientRect(),u=m.left-i.left+n/A*m.width-y,S=m.top-i.top+o/N*m.height-d,g=u+y,E=S+d;window.scrollTo({behavior:a,left:u,top:S}),a!=="instant"&&triggerRipple(l,g,E,"typst-jump-ripple","typst-jump-ripple-effect .4s linear"),f(c,n,o);return}};function triggerRipple(t,e,n,o,r){const a=document.createElement("div");a.className=o,a.style.left=`${e}px`,a.style.top=`${n}px`,t.appendChild(a),a.style.animation=r,a.onanimationend=()=>{t.removeChild(a)}}var scriptTag=document.currentScript;if(scriptTag){console.log("new svg util updated 37  ",performance.now());const t=findAncestor(scriptTag,"typst-doc");t&&window.typstProcessSvg(t)}function findLinkInSvg(t,e,n){const o=t.getBoundingClientRect();if(!(e[0]<o.left-1||e[0]>o.right+1||e[1]<o.top-1||e[1]>o.bottom+1)){if(t.classList.contains("pseudo-link"))return t;for(let r=0;r<t.children.length;r++){const a=findLinkInSvg(t.children[r],e,n);if(a)return a}}}window.typstBindSemantics=function(t,e,n){n.addEventListener("mousemove",o=>{ignoredEvent(()=>{if(o.target?.tagName==="A"){const r=o.target;if(r.cachedTarget)return;const a=findLinkInSvg(e,[o.clientX,o.clientY],o.target);if(a){a.dispatchEvent(new MouseEvent("mousemove",{bubbles:!0}));const f=semaLinkEnter(a,r);r.addEventListener("mouseenter",()=>{a.dispatchEvent(new MouseEvent("mouseenter",{bubbles:!0})),f()}),r.addEventListener("mousemove",()=>{a.dispatchEvent(new MouseEvent("mousemove",{bubbles:!0})),linkmove(a)}),r.addEventListener("mouseleave",()=>{a.dispatchEvent(new MouseEvent("mouseleave",{bubbles:!0})),linkleave(a)})}}},100,"mouseenter")})};
